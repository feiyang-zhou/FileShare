<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通平台数据处理工具说明文档（沙其版本）</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #e74c3c;
            padding-left: 15px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h4 {
            color: #34495e;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .emoji {
            font-size: 1.2em;
            margin-right: 8px;
        }
        ul, ol {
            margin-bottom: 15px;
            padding-left: 25px;
        }
        li {
            margin-bottom: 8px;
        }
        .highlight {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            font-size: 14px;
            white-space: pre-wrap;
            line-height: 1.4;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.2s ease;
            border-top: 4px solid #e74c3c;
        }
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .feature-card h4 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 12px;
        }
        .step-list {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }
        .step-list li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 40px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            padding: 15px 15px 15px 50px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #e74c3c;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #e74c3c;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f0f8ff;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .info {
            background-color: #fdf2e9;
            border: 1px solid #f39c12;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .special-feature {
            background-color: #fdf2e9;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .special-feature h3 {
            color: #e74c3c;
            margin-top: 0;
        }
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .toc h3 {
            margin-top: 0;
            color: #495057;
        }
        .toc ul {
            columns: 2;
            column-gap: 30px;
        }
        .toc a {
            color: #e74c3c;
            text-decoration: none;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stats-card {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stats-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stats-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        @media (max-width: 768px) {
            .toc ul {
                columns: 1;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="emoji">📋</span>通平台数据处理工具说明文档（沙其版本）</h1>

        <div class="toc">
            <h3>📋 目录导航</h3>
            <ul>
                <li><a href="#overview">工具概述</a></li>
                <li><a href="#features">功能特点</a></li>
                <li><a href="#architecture">预定义科室架构</a></li>
                <li><a href="#requirements">数据要求</a></li>
                <li><a href="#formats">数据格式要求</a></li>
                <li><a href="#output">输出格式</a></li>
                <li><a href="#processing">特殊处理机制</a></li>
                <li><a href="#classification">门诊/住院判断标准</a></li>
                <li><a href="#integration">科室架构集成处理</a></li>
                <li><a href="#version-features">版本特性</a></li>
                <li><a href="#usage">使用步骤</a></li>
                <li><a href="#notes">注意事项</a></li>
                <li><a href="#shaqi-features">沙其版本特性</a></li>
            </ul>
        </div>

        <div id="overview">
            <h2><span class="emoji">📋</span>工具概述</h2>
            <p>通平台数据处理工具（沙其版本）是一个专业的医疗数据标准化处理系统，能够将多个医疗相关的Excel文件转换为标准化的目标表格，支持复杂的科室结构识别和医保编码匹配。本版本采用预定义的科室架构配置，确保科室分类的一致性和准确性。</p>
        </div>        <d
iv id="features">
            <h2><span class="emoji">🔧</span>功能特点</h2>
            
            <h3>1. 核心功能</h3>
            <ul>
                <li><strong>医疗数据标准化处理</strong>：将多个医疗相关Excel文件转换为标准化的目标表格</li>
                <li><strong>四工作表输出</strong>：生成包含4个工作表的Excel文件
                    <ul>
                        <li>医院药品信息表</li>
                        <li>药品使用信息表</li>
                        <li>科室信息表（支持四级结构）</li>
                        <li>药费及人次汇总表</li>
                    </ul>
                </li>
            </ul>

            <h3>2. 高级特性</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>预定义科室架构系统</h4>
                    <p>采用固化的科室架构配置，包含582个科室记录</p>
                </div>
                <div class="feature-card">
                    <h4>智能科室层级识别</h4>
                    <p>支持主科室与亚专业科室的自动识别和分类</p>
                </div>
                <div class="feature-card">
                    <h4>科室结构总表维护</h4>
                    <p>自动维护桌面科室结构总表，确保科室ID一致性</p>
                </div>
                <div class="feature-card">
                    <h4>医保编码智能匹配</h4>
                    <p>通过药品编码精确匹配医保编码</p>
                </div>
                <div class="feature-card">
                    <h4>前导零格式保护</h4>
                    <p>确保科室ID保持正确格式（如029000而非29000.0）</p>
                </div>
                <div class="feature-card">
                    <h4>新增科室高亮</h4>
                    <p>新增科室在总表中自动标记为绿色高亮</p>
                </div>
            </div>

            <h3>3. 用户界面特性</h3>
            <ul>
                <li><strong>图形化界面</strong>：友好GUI界面</li>
                <li><strong>实时日志显示</strong>：处理过程实时显示详细日志</li>
                <li><strong>进度条显示</strong>：可视化处理进度</li>
                <li><strong>文件自动检测</strong>：智能查找和识别数据文件</li>
                <li><strong>版本选择支持</strong>：支持通平台1.4、1.5和1.6版本切换</li>
            </ul>
        </div>

        <div id="architecture" class="special-feature">
            <h2><span class="emoji">🏥</span>沙其版本特色：预定义科室架构</h2>
            
            <h3>科室架构统计</h3>
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stats-number">120</div>
                    <div class="stats-label">主科室分组</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number">582</div>
                    <div class="stats-label">详细科室记录</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number">35</div>
                    <div class="stats-label">儿科亚专业</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number">23</div>
                    <div class="stats-label">特需门诊</div>
                </div>
            </div>

            <h3>主要科室分类示例</h3>

            <h4>门诊科室（带"+"标识的主科室）</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>儿科+</h4>
                    <p>包含35个亚专业科室</p>
                    <ul>
                        <li>儿科(儿童肥胖)门诊</li>
                        <li>儿科(小儿心血管系统)门诊</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>内分泌科+</h4>
                    <p>包含21个亚专业科室</p>
                    <ul>
                        <li>内分泌科(糖尿病足)门诊</li>
                        <li>内分泌科(甲状腺眼病)门诊</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>呼吸与危重症医学科+</h4>
                    <p>包含17个亚专业科室</p>
                    <ul>
                        <li>呼吸内科(哮喘专病)门诊</li>
                        <li>呼吸内科(肺癌与肺部小结节)门诊</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>皮肤科+</h4>
                    <p>包含20个亚专业科室</p>
                    <ul>
                        <li>皮肤科(白癜风及色素性皮肤病)门诊</li>
                        <li>皮肤科(激光及注射)门诊</li>
                    </ul>
                </div>
            </div>

            <h4>住院科室（无"+"标识）</h4>
            <ul>
                <li><strong>心血管内科</strong>：心血管内科A区、B区、C区及对应护理单元</li>
                <li><strong>神经内科</strong>：神经内科A区、B区、C区及重症监护病房</li>
                <li><strong>肿瘤内科</strong>：肿瘤内科A区、B区、C区及日间化疗病房</li>
                <li><strong>骨科</strong>：骨科A区、B区、C区及对应护理单元</li>
            </ul>

            <h4>特殊科室分类</h4>
            <ul>
                <li><strong>特需门诊</strong>：包含23个特需专科门诊</li>
                <li><strong>急诊科+</strong>：包含11个急诊专科</li>
                <li><strong>中医科+</strong>：包含16个中医专科门诊</li>
                <li><strong>蒙医科+</strong>：包含10个蒙医特色门诊</li>
            </ul>

            <h3>科室架构识别逻辑</h3>

            <h4>1. 主科室识别</h4>
            <p>系统根据预定义的科室架构表自动识别主科室：</p>
            <div class="code-block">
# 主科室示例
main_departments = [
    "儿科+", "内分泌科+", "呼吸与危重症医学科+", 
    "心血管内科", "神经内科", "肿瘤内科"
]
            </div>

            <h4>2. 亚专业科室识别</h4>
            <p>每个主科室下包含多个亚专业科室：</p>
            <div class="code-block">
# 亚专业科室示例
sub_departments = {
    "儿科+": [
        "儿科(儿童肥胖)门诊",
        "儿科(小儿心血管系统)门诊",
        "儿科门诊"
    ]
}
            </div>

            <h4>3. 动态推断机制</h4>
            <p>对于架构表中未明确定义的科室，系统提供智能推断：</p>
            <ul>
                <li><strong>关键词匹配</strong>：根据科室名称中的关键词推断主科室</li>
                <li><strong>模式识别</strong>：识别括号、专科标识等模式</li>
                <li><strong>默认分类</strong>：未识别科室归入相应的默认分组</li>
            </ul>
        </div>

        <div id="requirements">
            <h2><span class="emoji">📁</span>数据要求</h2>
            
            <h3>必需文件（4个）</h3>
            <ol>
                <li><strong>科室药品使用金额及使用量DDDs排名表</strong>
                    <ul>
                        <li>格式：Excel文件（.xlsx/.xls）</li>
                        <li>包含科室药品使用数据和DDDs排名信息</li>
                    </ul>
                </li>
                <li><strong>门诊病人指标文件</strong>
                    <ul>
                        <li>格式：Excel文件</li>
                        <li>包含门诊患者统计数据</li>
                    </ul>
                </li>
                <li><strong>住院病人指标文件</strong>
                    <ul>
                        <li>格式：Excel文件</li>
                        <li>包含住院患者统计数据</li>
                    </ul>
                </li>
                <li><strong>公立医疗机构药品目录</strong>
                    <ul>
                        <li>格式：Excel文件</li>
                        <li>用于医保编码映射和药品信息匹配</li>
                    </ul>
                </li>
            </ol>

            <h3>可选文件（2个）</h3>
            <ol>
                <li><strong>住院患者静脉输液使用监测指标调查表</strong>
                    <ul>
                        <li>用于计算平均住院天数和住院总人天数</li>
                    </ul>
                </li>
                <li><strong>科室结构总表</strong>
                    <ul>
                        <li>自定义科室结构，不选择时使用桌面默认表</li>
                    </ul>
                </li>
            </ol>
        </div> 
       <div id="formats">
            <h2><span class="emoji">📊</span>数据格式要求</h2>
            
            <h3>科室药品使用数据表必须列</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>列名</th>
                            <th>说明</th>
                            <th>备注</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>排名</td><td>药品排名信息</td><td>必需</td></tr>
                        <tr><td>科室名称</td><td>科室完整名称</td><td>必需</td></tr>
                        <tr><td>科室药品总金额</td><td>科室药品总费用</td><td>必需</td></tr>
                        <tr><td>药品排名</td><td>具体药品排名</td><td>必需</td></tr>
                        <tr><td>药品名称</td><td>药品完整名称</td><td>必需</td></tr>
                        <tr><td>药品编码</td><td>院内药品唯一标识码</td><td>必需</td></tr>
                        <tr><td>医保编码</td><td>国家医保统一编码</td><td>必需</td></tr>
                        <tr><td>药品通用名</td><td>药品通用名称</td><td>必需</td></tr>
                        <tr><td>剂型</td><td>药品剂型信息</td><td>必需</td></tr>
                        <tr><td>规格</td><td>药品规格描述</td><td>必需</td></tr>
                        <tr><td>厂家</td><td>生产厂家信息</td><td>必需</td></tr>
                        <tr><td>使用量DDDs</td><td>DDDs使用量数据</td><td>必需</td></tr>
                        <tr><td>数量</td><td>使用数量（支持"114+-120"等格式）</td><td>必需</td></tr>
                        <tr><td>计价单位</td><td>计价单位</td><td>必需</td></tr>
                        <tr><td>单价</td><td>药品单价</td><td>可选（支持15列和16列格式）</td></tr>
                        <tr><td>总金额</td><td>使用总金额</td><td>必需</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>公立医疗机构药品目录格式</h3>
            
            <div class="info">
                <h4>重要说明</h4>
                <p><strong>沙其版本不支持简单的三列格式</strong>，需要通过智能列名识别自动匹配相应的列。</p>
            </div>

            <h4>必需列（4个）</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>1. 医保编码列</h4>
                    <p>必须包含以下关键词之一：</p>
                    <ul>
                        <li>"医保编码"</li>
                        <li>"医保" + "编码"</li>
                        <li>"统一编码"</li>
                        <li>"国家编码"</li>
                        <li>"编码"</li>
                        <li>"医保"</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>2. 药品编码列</h4>
                    <p>必须包含以下关键词之一：</p>
                    <ul>
                        <li>"院内药品唯一码"</li>
                        <li>"药品唯一码"</li>
                        <li>"院内编码"</li>
                        <li>"药品编码"</li>
                        <li>"内部编码"</li>
                        <li>"唯一码"</li>
                        <li>"药品"</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>3. 产品名称列</h4>
                    <p>必须包含以下关键词之一：</p>
                    <ul>
                        <li>"产品名称"</li>
                        <li>"药品名称"</li>
                        <li>"通用名"</li>
                        <li>"名称"</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>4. 规格列</h4>
                    <p>包含以下关键词之一：</p>
                    <ul>
                        <li>"制剂规格"</li>
                        <li>"规格"</li>
                        <li>"包装规格"</li>
                        <li>"药品规格"</li>
                    </ul>
                </div>
            </div>

            <h4>匹配逻辑说明</h4>
            <ul>
                <li><strong>智能识别</strong>：系统通过列名中的关键词自动识别列，不依赖固定的列位置</li>
                <li><strong>最低要求</strong>：至少需要前3个必需列才能正常处理</li>
                <li><strong>匹配逻辑</strong>：
                    <ul>
                        <li>优先进行严格匹配（列名包含所有关键词）</li>
                        <li>如果严格匹配失败，则进行部分匹配（列名包含任意关键词）</li>
                    </ul>
                </li>
                <li><strong>数据质量</strong>：每行数据中这些列都应该有有效值，空值或"nan"会被跳过</li>
            </ul>

            <h4>示例列名</h4>
            <div class="highlight">
                <h4><span class="success">✅ 有效的列名示例：</span></h4>
                <ul>
                    <li>医保编码、国家医保编码、统一医保编码</li>
                    <li>院内药品唯一码、药品编码、内部药品编码</li>
                    <li>产品名称、药品名称、药品通用名</li>
                    <li>制剂规格、药品规格、包装规格</li>
                </ul>
                
                <h4><span class="error">❌ 无效的列名示例：</span></h4>
                <ul>
                    <li>序号、ID、编号（太模糊）</li>
                    <li>备注、说明（不相关）</li>
                    <li>Unnamed: 0（Excel默认列名）</li>
                </ul>
            </div>

            <h3>科室名称格式要求</h3>
            <ul>
                <li>支持英文前缀自动去除（如"A-心内科"→"心内科"）</li>
                <li>支持门诊/住院/病房后缀识别</li>
                <li>集成预定义科室架构，优先使用架构表中的分类</li>
                <li>支持动态推断未知科室的主科室归属</li>
            </ul>
        </div>

        <div id="output">
            <h2><span class="emoji">🎯</span>输出格式</h2>
            
            <h3>输出文件结构</h3>
            <ul>
                <li><strong>文件格式</strong>：Excel文件（.xlsx）</li>
                <li><strong>工作表数量</strong>：4个</li>
                <li><strong>默认保存位置</strong>：桌面/结果文件/文件夹</li>
                <li><strong>文件命名</strong>：目标表格_时间戳.xlsx</li>
            </ul>

            <h3>各工作表内容</h3>
            <ol>
                <li><strong>医院药品信息</strong>：医院药品基础信息表</li>
                <li><strong>药品使用信息</strong>：详细的药品使用记录</li>
                <li><strong>科室信息</strong>：科室层级结构（包含单元格合并）</li>
                <li><strong>药费及人次</strong>：按科室汇总的费用和人次统计</li>
            </ol>
        </div>

        <div id="processing">
            <h2><span class="emoji">⚙️</span>特殊处理机制</h2>
            
            <h3>智能列名检测</h3>
            <ul>
                <li>自动检测Excel文件中的真正列名行</li>
                <li>支持跳过标题行和空行</li>
                <li>智能匹配关键词进行列名识别</li>
            </ul>

            <h3>ID格式保护</h3>
            <ul>
                <li>确保科室ID保持前导零格式</li>
                <li>防止Excel自动转换为数字格式</li>
                <li>支持多种ID长度（2位、3位、4位、5位、6位、7位）</li>
            </ul>

            <h3>数据类型兼容</h3>
            <ul>
                <li>支持浮点数格式的编码转换</li>
                <li>处理"106079.0"→"106079"的格式转换</li>
                <li>支持多种编码格式的映射匹配</li>
                <li>兼容15列和16列的DDS表格式</li>
            </ul>
        </div>

        <div id="classification">
            <h2><span class="emoji">🏥</span>门诊/住院判断标准</h2>
            
            <h3>判断逻辑（按优先级）</h3>
            <div class="code-block">
def determine_dept_type(dept_name):
    if pd.isna(dept_name):
        return ''
    dept_str = str(dept_name).strip()
    
    # 特殊情况：急诊科归类为门诊
    if dept_str == '急诊科':
        return '门诊'
    
    # 1. 以"门诊"结尾的科室 → 门诊
    if '门诊' in dept_str:
        return '门诊'
    # 2. 其他科室 → 默认为住院
    else:
        return '住院'
            </div>

            <h3>具体判断标准</h3>
            
            <h4>门诊科室识别</h4>
            <ul>
                <li><strong>明确标识</strong>：科室名称包含"门诊"
                    <ul>
                        <li>示例：<code>心内科门诊</code>、<code>神经内科门诊</code>、<code>肿瘤门诊</code></li>
                    </ul>
                </li>
                <li><strong>特殊处理</strong>：急诊科归类为门诊</li>
            </ul>

            <h4>住院科室识别</h4>
            <ul>
                <li><strong>默认归类</strong>：不包含"门诊"的科室默认为住院
                    <ul>
                        <li>示例：<code>心内科A区</code>、<code>神经内科病房</code>、<code>ICU</code></li>
                    </ul>
                </li>
            </ul>
        </div>        
<div id="integration">
            <h2><span class="emoji">🏗️</span>科室架构集成处理</h2>
            
            <h3>架构优先原则</h3>
            <p>沙其版本优先使用预定义的科室架构进行科室分类：</p>
            
            <ol>
                <li><strong>架构表查找</strong>：首先在预定义架构表中查找科室</li>
                <li><strong>精确匹配</strong>：对于架构表中的科室，使用预定义的主科室分类</li>
                <li><strong>智能推断</strong>：对于架构表外的科室，使用推断算法确定分类</li>
                <li><strong>动态更新</strong>：新识别的科室动态添加到分类系统中</li>
            </ol>

            <h3>科室分组逻辑</h3>

            <h4>主科室分组</h4>
            <ul>
                <li><strong>混合科室</strong>：同时有门诊和住院的基础科室保持独立二级结构</li>
                <li><strong>其他门诊</strong>：仅有门诊的科室归入"其他门诊"二级结构</li>
                <li><strong>其他住院</strong>：仅有住院的科室归入"其他住院"二级结构</li>
                <li><strong>架构科室</strong>：预定义架构中的科室按架构分类</li>
            </ul>

            <h4>ID分配规则</h4>
            <div class="code-block">
# 混合科室（既有门诊又有住院）
门诊三级ID = f"{二级ID}0"  # 如: 0010
住院三级ID = f"{二级ID}1"  # 如: 0011

# 其他门诊组
三级ID = f"{二级ID}{计数器:03d}"  # 如: 001001

# 其他住院组  
三级ID = f"{二级ID}{计数器:03d}"  # 如: 002001
            </div>
        </div>

        <div id="version-features">
            <h2><span class="emoji">🔧</span>版本特性</h2>
            
            <h3>通平台版本支持</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>1.4版本</h4>
                    <p>使用"规格转换系数"列名</p>
                </div>
                <div class="feature-card">
                    <h4>1.5版本</h4>
                    <p>使用"规格转换系数（非包装转换比）"列名</p>
                </div>
                <div class="feature-card">
                    <h4>动态切换</h4>
                    <p>GUI界面支持版本选择</p>
                </div>
            </div>

            <h3>数据兼容性</h3>
            <ul>
                <li><strong>15列DDS表</strong>：兼容缺少单价列的格式</li>
                <li><strong>16列DDS表</strong>：支持完整的DDS表格式</li>
                <li><strong>智能检测</strong>：自动识别并适配不同的列数格式</li>
            </ul>
        </div>

        <div id="usage">
            <h2><span class="emoji">🚀</span>使用步骤</h2>
            
            <ol class="step-list">
                <li><strong>选择必需文件</strong>：选择4个必需的Excel文件</li>
                <li><strong>配置可选文件</strong>：根据需要勾选并选择可选文件</li>
                <li><strong>选择通平台版本</strong>：在下拉框中选择1.4或1.5版本</li>
                <li><strong>设置时间参数</strong>：输入时间（格式：2025年9月）</li>
                <li><strong>设置输出位置</strong>：选择输出文件的保存位置和名称</li>
                <li><strong>开始处理</strong>：点击"开始处理数据"按钮</li>
                <li><strong>等待完成</strong>：查看处理进度和日志信息</li>
            </ol>
        </div>

        <div id="notes">
            <h2><span class="emoji">⚠️</span>注意事项</h2>
            
            <div class="warning">
                <ul>
                    <li>确保输入文件格式正确</li>
                    <li>处理期间请勿关闭程序</li>
                    <li>大数据量处理时确保内存充足</li>
                    <li>新增科室在科室结构总表中自动标记为绿色高亮</li>
                    <li>预定义科室架构确保分类的一致性和准确性</li>
                    <li>支持15列和16列两种DDS表格式</li>
                </ul>
            </div>
        </div>

        <div id="shaqi-features" class="special-feature">
            <h2><span class="emoji">🆕</span>沙其版本特性</h2>
            
            <h3>核心优势</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>固化科室架构</h4>
                    <p>采用预定义的582个科室记录，确保分类准确性</p>
                </div>
                <div class="feature-card">
                    <h4>智能科室识别</h4>
                    <p>结合架构表和推断算法，提高科室分类准确率</p>
                </div>
                <div class="feature-card">
                    <h4>版本兼容性</h4>
                    <p>支持通平台1.4和1.5版本的差异化处理</p>
                </div>
                <div class="feature-card">
                    <h4>数据格式兼容</h4>
                    <p>支持多种DDS表格式，提高数据处理灵活性</p>
                </div>
            </div>

            <h3>架构管理</h3>
            <ul>
                <li><strong>JSON配置文件</strong>：科室架构存储在dept_structure.json中</li>
                <li><strong>PyInstaller兼容</strong>：解决打包后的路径问题</li>
                <li><strong>动态加载</strong>：支持运行时加载和更新科室架构</li>
                <li><strong>统计功能</strong>：提供详细的科室架构统计信息</li>
            </ul>

            <h3>处理优化</h3>
            <ul>
                <li><strong>智能列检测</strong>：增强的Excel列名识别算法</li>
                <li><strong>格式保护</strong>：确保科室ID和编码格式的正确性</li>
                <li><strong>错误处理</strong>：完善的异常处理和日志记录</li>
                <li><strong>性能优化</strong>：优化大数据量处理性能</li>
            </ul>
        </div>

        <hr style="margin: 40px 0; border: none; border-top: 2px solid #eee;">
        
        <div style="text-align: center; color: #666; font-size: 14px;">
            <p><strong>版本</strong>: 2.0.0（沙其版本）</p>
            <p><strong>更新时间</strong>: 2025年</p>
            <p><strong>开发说明</strong>: 这个工具是基于预定义科室架构的医疗数据处理系统，具有强大的数据标准化和格式转换能力，特别适合需要标准化科室分类的医疗机构进行数据整理和上报工作。沙其版本通过固化科室架构配置，确保了科室分类的一致性和准确性。</p>
        </div>
    </div>
</body>
</html>